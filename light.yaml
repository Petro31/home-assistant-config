- platform: group
  name: Main Door Bulbs
  entities:
  - light.main_door_left_bulb
  - light.main_door_right_bulb

- platform: group
  name: Garage Sconces Bulbs
  entities:
  - light.garage_sconce_left_bulb
  - light.garage_sconce_right_bulb

- platform: group
  name: Outdoor Bulbs
  entities:
  - light.main_door_left_bulb
  - light.main_door_right_bulb
  - light.passenger_door_bulb
  - light.garage_sconce_left_bulb
  - light.garage_sconce_right_bulb

- platform: group
  name: Primary Holiday Bulbs Set
  entities:
  - light.main_door_left_bulb
  - light.passenger_door_bulb
  - light.garage_sconce_right_bulb

- platform: group
  name: Secondary Holiday Bulbs Set
  entities:
  - light.main_door_right_bulb
  - light.garage_sconce_left_bulb

# Zwave Multicast Lights for ON/OFF in unison.

# This is code to autogenerate the lights because I'm lazy.

# {% set groups = states.group | selectattr('entity_id','search','area') | list %}
# {% set fmat = """
#
#     #################################
#     ### {1:^25} ###
#     #################################
# 
#     {0}:
#       unique_id: {0}
#       friendly_name: {1}
#       value_template: >
#         {{{{ is_state('group.{0}', 'on') }}}}
#       level_template: >
#         {{%- set entities = expand('group.{0}') %}}
#         {{%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}}
#         {{%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}}
#         {{{{- levels | average if levels else 0 }}}}
#       availability_template: >
#         {{{{- expand('group.{0}') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}}}
#       turn_on:
#       - service: script.zwave_multicast_group
#         data:
#           group: group.{0}
#           level: 99
#       turn_off:
#       - service: script.zwave_multicast_group
#         data:
#           group: group.{0}
#           level: 0
#       set_level:
#       - service: script.zwave_multicast_group
#         data:
#           group: group.{0}
#           level: >
#             {{{{- brightness }}}}
# """ %}
# - platform: template
#   lights:
# {%- for group in groups %}
# {{ fmat.format(group.object_id, group.name) }}
# {%- endfor %}

- platform: template
  lights:

    #################################
    ###         All Areas         ###
    #################################

    all_areas:
      unique_id: all_areas
      friendly_name: All Areas
      value_template: >
        {{ is_state('group.all_areas', 'on') }}
      level_template: >
        {%- set entities = expand('group.all_areas') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.all_areas') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.all_areas
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.all_areas
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.all_areas
          level: >
            {{- brightness }}


    #################################
    ###         Basement          ###
    #################################

    basement_area:
      unique_id: basement_area
      friendly_name: Basement
      value_template: >
        {{ is_state('group.basement_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.basement_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.basement_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.basement_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.basement_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.basement_area
          level: >
            {{- brightness }}


    #################################
    ###        Bonus Room         ###
    #################################

    bonus_room_area:
      unique_id: bonus_room_area
      friendly_name: Bonus Room
      value_template: >
        {{ is_state('group.bonus_room_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.bonus_room_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.bonus_room_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.bonus_room_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.bonus_room_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.bonus_room_area
          level: >
            {{- brightness }}


    #################################
    ###        Dining Room        ###
    #################################

    dining_room_area:
      unique_id: dining_room_area
      friendly_name: Dining Room
      value_template: >
        {{ is_state('group.dining_room_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.dining_room_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.dining_room_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.dining_room_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.dining_room_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.dining_room_area
          level: >
            {{- brightness }}


    #################################
    ###        Downstairs         ###
    #################################

    downstairs_area:
      unique_id: downstairs_area
      friendly_name: Downstairs
      value_template: >
        {{ is_state('group.downstairs_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.downstairs_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.downstairs_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_area
          level: >
            {{- brightness }}


    #################################
    ###        Downstairs         ###
    #################################

    downstairs_areas:
      unique_id: downstairs_areas
      friendly_name: Downstairs
      value_template: >
        {{ is_state('group.downstairs_areas', 'on') }}
      level_template: >
        {%- set entities = expand('group.downstairs_areas') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.downstairs_areas') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_areas
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_areas
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.downstairs_areas
          level: >
            {{- brightness }}


    #################################
    ###           Foyer           ###
    #################################

    foyer_area:
      unique_id: foyer_area
      friendly_name: Foyer
      value_template: >
        {{ is_state('group.foyer_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.foyer_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.foyer_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.foyer_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.foyer_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.foyer_area
          level: >
            {{- brightness }}


    #################################
    ###         Game Room         ###
    #################################

    game_room_area:
      unique_id: game_room_area
      friendly_name: Game Room
      value_template: >
        {{ is_state('group.game_room_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.game_room_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.game_room_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_area
          level: >
            {{- brightness }}


    #################################
    ###     Game Room Target      ###
    #################################

    game_room_target_area:
      unique_id: game_room_target_area
      friendly_name: Game Room Target
      value_template: >
        {{ is_state('group.game_room_target_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.game_room_target_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.game_room_target_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_target_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_target_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.game_room_target_area
          level: >
            {{- brightness }}


    #################################
    ###          Garage           ###
    #################################

    garage_area:
      unique_id: garage_area
      friendly_name: Garage
      value_template: >
        {{ is_state('group.garage_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.garage_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.garage_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_area
          level: >
            {{- brightness }}


    #################################
    ###      Garage Entrance      ###
    #################################

    garage_entrance_area:
      unique_id: garage_entrance_area
      friendly_name: Garage Entrance
      value_template: >
        {{ is_state('group.garage_entrance_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.garage_entrance_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.garage_entrance_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_entrance_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_entrance_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.garage_entrance_area
          level: >
            {{- brightness }}


    #################################
    ###           Hall            ###
    #################################

    hall_area:
      unique_id: hall_area
      friendly_name: Hall
      value_template: >
        {{ is_state('group.hall_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.hall_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.hall_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.hall_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.hall_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.hall_area
          level: >
            {{- brightness }}


    #################################
    ###          Inside           ###
    #################################

    inside_area:
      unique_id: inside_area
      friendly_name: Inside
      value_template: >
        {{ is_state('group.inside_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.inside_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.inside_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_area
          level: >
            {{- brightness }}


    #################################
    ###          Inside           ###
    #################################

    inside_areas:
      unique_id: inside_areas
      friendly_name: Inside
      value_template: >
        {{ is_state('group.inside_areas', 'on') }}
      level_template: >
        {%- set entities = expand('group.inside_areas') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.inside_areas') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_areas
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_areas
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.inside_areas
          level: >
            {{- brightness }}


    #################################
    ###          Kitchen          ###
    #################################

    kitchen_area:
      unique_id: kitchen_area
      friendly_name: Kitchen
      value_template: >
        {{ is_state('group.kitchen_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.kitchen_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.kitchen_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_area
          level: >
            {{- brightness }}


    #################################
    ###      Kitchen Target       ###
    #################################

    kitchen_target_area:
      unique_id: kitchen_target_area
      friendly_name: Kitchen Target
      value_template: >
        {{ is_state('group.kitchen_target_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.kitchen_target_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.kitchen_target_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_target_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_target_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.kitchen_target_area
          level: >
            {{- brightness }}


    #################################
    ###       Laundry Room        ###
    #################################

    laundry_area:
      unique_id: laundry_area
      friendly_name: Laundry Room
      value_template: >
        {{ is_state('group.laundry_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.laundry_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.laundry_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.laundry_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.laundry_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.laundry_area
          level: >
            {{- brightness }}


    #################################
    ###        Living Room        ###
    #################################

    living_room_area:
      unique_id: living_room_area
      friendly_name: Living Room
      value_template: >
        {{ is_state('group.living_room_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.living_room_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.living_room_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.living_room_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.living_room_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.living_room_area
          level: >
            {{- brightness }}


    #################################
    ###      Master Bathroom      ###
    #################################

    master_bathroom_area:
      unique_id: master_bathroom_area
      friendly_name: Master Bathroom
      value_template: >
        {{ is_state('group.master_bathroom_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.master_bathroom_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.master_bathroom_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_area
          level: >
            {{- brightness }}


    #################################
    ###  Master Bathroom Target   ###
    #################################

    master_bathroom_target_area:
      unique_id: master_bathroom_target_area
      friendly_name: Master Bathroom Target
      value_template: >
        {{ is_state('group.master_bathroom_target_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.master_bathroom_target_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.master_bathroom_target_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_target_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_target_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bathroom_target_area
          level: >
            {{- brightness }}


    #################################
    ###      Master Bedroom       ###
    #################################

    master_bedroom_area:
      unique_id: master_bedroom_area
      friendly_name: Master Bedroom
      value_template: >
        {{ is_state('group.master_bedroom_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.master_bedroom_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.master_bedroom_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bedroom_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bedroom_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.master_bedroom_area
          level: >
            {{- brightness }}


    #################################
    ###    Master Suite Target    ###
    #################################

    master_suite_target_area:
      unique_id: master_suite_target_area
      friendly_name: Master Suite Target
      value_template: >
        {{ is_state('group.master_suite_target_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.master_suite_target_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.master_suite_target_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.master_suite_target_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.master_suite_target_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.master_suite_target_area
          level: >
            {{- brightness }}


    #################################
    ###          Office           ###
    #################################

    office_area:
      unique_id: office_area
      friendly_name: Office
      value_template: >
        {{ is_state('group.office_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.office_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.office_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.office_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.office_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.office_area
          level: >
            {{- brightness }}


    #################################
    ###          Outside          ###
    #################################

    outside_area:
      unique_id: outside_area
      friendly_name: Outside
      value_template: >
        {{ is_state('group.outside_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.outside_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.outside_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_area
          level: >
            {{- brightness }}


    #################################
    ###          Outside          ###
    #################################

    outside_areas:
      unique_id: outside_areas
      friendly_name: Outside
      value_template: >
        {{ is_state('group.outside_areas', 'on') }}
      level_template: >
        {%- set entities = expand('group.outside_areas') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.outside_areas') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_areas
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_areas
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.outside_areas
          level: >
            {{- brightness }}


    #################################
    ###         Upstairs          ###
    #################################

    upstairs_area:
      unique_id: upstairs_area
      friendly_name: Upstairs
      value_template: >
        {{ is_state('group.upstairs_area', 'on') }}
      level_template: >
        {%- set entities = expand('group.upstairs_area') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.upstairs_area') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_area
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_area
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_area
          level: >
            {{- brightness }}


    #################################
    ###         Upstairs          ###
    #################################

    upstairs_areas:
      unique_id: upstairs_areas
      friendly_name: Upstairs
      value_template: >
        {{ is_state('group.upstairs_areas', 'on') }}
      level_template: >
        {%- set entities = expand('group.upstairs_areas') %}
        {%- set lights = entities | selectattr('domain', 'eq', 'light') | selectattr('state', 'eq', 'on') %}
        {%- set levels = lights | map(attribute='attributes.brightness') | map('int') | list %}
        {{- levels | average if levels else 0 }}
      availability_template: >
        {{- expand('group.upstairs_areas') | selectattr('state','in',['unavailable','unknown']) | list | length == 0 }}
      turn_on:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_areas
          level: 99
      turn_off:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_areas
          level: 0
      set_level:
      - service: script.zwave_multicast_group
        data:
          group: group.upstairs_areas
          level: >
            {{- brightness }}
